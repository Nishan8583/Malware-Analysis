#include <iostream>
#include <windows.h>

int main() {
	
	// Our malicious code
	char malcode[] = { 0x89, 0xC8, 0x40, 0xC3 };
	
	// The space that will contain the malicious code
	void * pfunc = VirtualAlloc(NULL,4096,MEM_COMMIT,PAGE_EXECUTE_READWRITE);
	
	// Copying the malicious code from char to heap allocated memory
	memcpy(pfunc,(void *)malcode,sizeof(malcode));
	
	// Creating a function poitner of return type int and takes argument int
	int (*fn)(int) = (int (*)(int))pfunc;
	std::cout << fn(2);
	
	// Freeing the memory
	VirtualFree(pfunc,NULL,MEM_RELEASE);
	
}
